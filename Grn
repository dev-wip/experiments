SUMMARY = "Generates an empty ext4 data partition"
LICENSE = "MIT"
LIC_FILES_CHKSUM = "file://${COMMON_LICENSE_DIR}/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302"

DEPENDS = "e2fsprogs-native"

inherit deploy

DATA_PART_SIZE_MB = "120"
DATA_PART_NAME = "data.ext4"

# 1. Generate the file in the safe working directory
do_compile() {
    dd if=/dev/zero of=${WORKDIR}/${DATA_PART_NAME} bs=1M count=${DATA_PART_SIZE_MB}
    mkfs.ext4 -F -L "DATA" ${WORKDIR}/${DATA_PART_NAME}
}

# 2. Deploy it using standard Yocto mechanisms
do_deploy() {
    install -d ${DEPLOYDIR}
    install -m 0644 ${WORKDIR}/${DATA_PART_NAME} ${DEPLOYDIR}/
}

addtask deploy after do_compile
